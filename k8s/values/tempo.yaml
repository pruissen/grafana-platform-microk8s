# k8s/values/tempo.yaml
# Chart: tempo-distributed
# Version: 1.59.0

# 1. Global Settings
# ‚úÖ Enable Multitenancy
multitenancyEnabled: true

# ‚ö†Ô∏è FIX for "Pending" pods on Laptop:
# Disable High Availability constraints so pods can run on the same node.
global:
  affinity: {}
  topologySpreadConstraints: []
  extraEnvFrom:
    - secretRef:
        name: tempo-s3-credentials

# 2. Service Account
# Required because we removed fullnameOverride; ensures clean creation.
serviceAccount:
  create: true
  name: null

# 3. Traces (OTLP)
traces:
  otlp:
    http: { enabled: true }
    grpc: { enabled: true }

# 4. Storage (S3/MinIO)
storage:
  trace:
    backend: s3
    s3:
      bucket: tempo-data
      endpoint: loki-minio.observability-prd.svc:9000
      insecure: true

# 5. Server Config
server:
  # ‚ö†Ô∏è Must be 3200 for Liveness Probes to pass
  httpListenPort: 3200
  grpcListenPort: 9095

# 6. Components (Laptop Scale)
# - Replicas: 1 (No HA)
# - Resources: Low Requests (Pack tight), High Limits (Allow bursts)
# - Affinity: Disabled (Fixes "Pending")

ingester:
  replicas: 1
  affinity: {}
  topologySpreadConstraints: []
  persistence:
    enabled: true
    size: 10Gi
  resources:
    requests: { cpu: 50m, memory: 128Mi }
    limits: { memory: 1Gi }

distributor:
  replicas: 1
  affinity: {}
  topologySpreadConstraints: []
  logReceivedTraces: false
  resources:
    requests: { cpu: 50m, memory: 64Mi }
    limits: { memory: 512Mi }

compactor:
  replicas: 1
  affinity: {}
  topologySpreadConstraints: []
  config:
    compaction:
      block_retention: 24h
  resources:
    requests: { cpu: 50m, memory: 64Mi }
    limits: { memory: 512Mi }

querier:
  replicas: 1
  affinity: {}
  topologySpreadConstraints: []
  resources:
    requests: { cpu: 50m, memory: 128Mi }
    limits: { memory: 1Gi }

queryFrontend:
  replicas: 1
  affinity: {}
  topologySpreadConstraints: []
  resources:
    requests: { cpu: 50m, memory: 64Mi }
    limits: { memory: 512Mi }

# 7. Gateway (Ingress/Auth)
gateway:
  enabled: true
  replicas: 1
  affinity: {}
  topologySpreadConstraints: []
  ingress:
    enabled: false # üö´ Disabled
  basicAuth:
    enabled: false
  resources:
    requests: { cpu: 20m, memory: 32Mi }
    limits: { memory: 128Mi }

# 8. Dependencies
memcached:
  enabled: true
  replicaCount: 1
  affinity: {}
  topologySpreadConstraints: []
  resources:
    requests: { cpu: 20m, memory: 32Mi }
    limits: { memory: 128Mi }

metaMonitoring:
  serviceMonitor:
    enabled: false