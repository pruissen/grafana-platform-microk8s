# k8s/values/tempo.yaml
# Chart Version: 1.10.1

# üîí INJECT CREDENTIALS
# Injects AWS_ACCESS_KEY_ID & AWS_SECRET_ACCESS_KEY
extraEnvFrom:
  - secretRef:
      name: tempo-s3-credentials

tempo:
  # üîí MULTI-TENANCY ENABLED (Requires X-Scope-OrgID header)
  multitenancy:
    enabled: true

  # Storage Configuration
  storage:
    trace:
      backend: s3
      s3:
        bucket: tempo-data
        endpoint: loki-minio.observability-prd.svc:9000
        # ‚ö†Ô∏è REQUIRED: Force HTTP (MinIO does not have TLS)
        insecure: true
        # No credentials here - handled by extraEnvFrom

  # Retention (Managed by Compactor)
  retention: 24h

# --- COMPONENT CONFIG ---
ingester:
  replicas: 1
  config:
    replication_factor: 1

distributor:
  config:
    log_received_traces: false

compactor:
  config:
    compaction:
      block_retention: 24h

# Metrics Generator (Creates metrics from traces)
metricsGenerator:
  enabled: true
  replicas: 1
  config:
    storage:
      remote_write:
        - url: http://mimir-nginx.observability-prd.svc:80/api/v1/push
          send_exemplars: true

server:
  http_listen_port: 3100
  grpc_listen_port: 9095