fullnameOverride: tempo-distributed

distributor:
  replicas: 1
  config:
    log_received_traces: true

storage:
  trace:
    backend: s3
    s3:
      bucket: tempo-traces
      # Ensure this matches your service name (minio-storage)
      endpoint: minio-storage.observability-prd.svc:9000
      access_key: admin
      secret_key: "${s3_secret_key}"
      insecure: true
    wal:
      path: /var/tempo/wal

ingester:
  replicas: 1
  persistence:
    enabled: true
    size: 10Gi
  config:
    replication_factor: 1

compactor:
  replicas: 1
  config:
    compaction:
      compaction_window: 1h
      max_block_bytes: 1073741824
      block_retention: 48h
      compacted_block_retention: 1h

querier:
  replicas: 1
  config:
    frontend_worker:
      frontend_address: tempo-distributed-query-frontend:9095

queryFrontend:
  replicas: 1

memcached:
  enabled: false

# --- FIX IS HERE ---
global_overrides:
  # Removed 'per_tenant_override_config' line which caused the crash
  metrics_generator_processors: [service-graphs, span-metrics]

gateway:
  enabled: true
  replicas: 1
  ingress:
    enabled: false

metricsGenerator:
  enabled: true
  replicas: 1
  config:
    storage:
      remote_write:
        # Ensure this matches your Mimir service name
        - url: http://mimir-distributor.observability-prd.svc:8080/api/v1/push
          send_exemplars: true

serviceMonitor:
  enabled: false