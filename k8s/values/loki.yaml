# k8s/values/loki.yaml
deploymentMode: SingleBinary

global:
  extraEnvFrom:
    - secretRef:
        name: loki-s3-credentials

loki:
  auth_enabled: true # âœ… Multitenancy Enabled
  
  commonConfig:
    replication_factor: 1
    ring:
      kvstore:
        store: memberlist
  storage:
    type: s3
    bucketNames:
      chunks: loki-chunks
      ruler: loki-ruler
      admin: loki-admin
    s3:
      endpoint: http://loki-minio.observability-prd.svc:9000
      s3ForcePathStyle: true
      insecure: true

  schemaConfig:
    configs:
      - from: 2024-01-01
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: index_
          period: 24h

singleBinary:
  replicas: 1
  persistence:
    enabled: true
    size: 10Gi
  # ðŸ’» Laptop Sizing:
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      memory: 2Gi # Allowed to burst, but won't reserve it all

minio:
  enabled: true
  rootUser: admin
  existingSecret: minio-creds
  persistence: { enabled: true, size: 10Gi }
  resources:
    requests: { memory: 256Mi }
    limits: { memory: 1Gi }
  buckets:
    - name: loki-chunks
      policy: none
    - name: loki-ruler
      policy: none
    - name: loki-admin
      policy: none
    - name: mimir-blocks
      policy: none
    - name: mimir-ruler
      policy: none
    - name: tempo-data
      policy: none

# Disable microservices
write: { replicas: 0 }
read: { replicas: 0 }
backend: { replicas: 0 }

gateway:
  replicas: 1
  ingress: { enabled: false } # ðŸš« Ingress Disabled
  resources:
    requests: { cpu: 50m, memory: 64Mi }
    limits: { memory: 256Mi }

monitoring:
  dashboards: { enabled: false }
  rules: { enabled: false }
  serviceMonitor: { enabled: false }
  selfMonitoring: { enabled: false, lokiCanary: { enabled: false } }