# k8s/values/mimir.yaml
# Version: 5.6.0

global:
  extraEnvFrom:
    - secretRef:
        name: mimir-s3-credentials

minio: { enabled: false }

mimir:
  auth_enabled: true # âœ… Multitenancy Enabled

  structuredConfig:
    common:
      storage:
        backend: s3
        s3:
          endpoint: loki-minio.observability-prd.svc:9000
          bucket_name: mimir-blocks
          insecure: true

    blocks_storage:
      backend: s3
      s3:
        bucket_name: mimir-blocks
        endpoint: loki-minio.observability-prd.svc:9000
        insecure: true
      tsdb:
        dir: /data/tsdb

    ruler_storage:
      backend: s3
      s3:
        bucket_name: mimir-ruler
        endpoint: loki-minio.observability-prd.svc:9000
        insecure: true

    alertmanager_storage:
      backend: s3
      s3:
        bucket_name: mimir-ruler
        endpoint: loki-minio.observability-prd.svc:9000
        insecure: true

    usage_stats: { enabled: false }

    # Laptop Optimization: Replication Factor 1
    ingester:
      ring: { replication_factor: 1 }
    store_gateway:
      sharding_ring: { replication_factor: 1 }
    distributor:
      ring: { kvstore: { store: memberlist } }

# ðŸ’» Laptop Sizing:
# Low requests allow efficient bin-packing on one node.
ingester:
  replicas: 1
  resources: { requests: { memory: 128Mi, cpu: 50m }, limits: { memory: 1Gi } }

store_gateway:
  replicas: 1
  resources: { requests: { memory: 128Mi, cpu: 50m }, limits: { memory: 1Gi } }

distributor:
  replicas: 1
  resources: { requests: { memory: 64Mi, cpu: 50m }, limits: { memory: 512Mi } }

querier:
  replicas: 1
  resources: { requests: { memory: 128Mi, cpu: 50m }, limits: { memory: 1Gi } }

query_frontend:
  replicas: 1
  resources: { requests: { memory: 64Mi, cpu: 50m }, limits: { memory: 512Mi } }

ruler:
  replicas: 1
  resources: { requests: { memory: 64Mi, cpu: 50m }, limits: { memory: 512Mi } }

compactor:
  replicas: 1
  resources: { requests: { memory: 64Mi, cpu: 50m }, limits: { memory: 512Mi } }

alertmanager:
  replicas: 1
  resources: { requests: { memory: 64Mi, cpu: 50m }, limits: { memory: 256Mi } }

overrides_exporter:
  replicas: 1
  resources: { requests: { memory: 32Mi, cpu: 10m }, limits: { memory: 128Mi } }

rollout_operator:
  enabled: true
  resources: { requests: { memory: 32Mi, cpu: 10m }, limits: { memory: 128Mi } }

nginx:
  enabled: true
  replicas: 1
  ingress: { enabled: false } # ðŸš« Ingress Disabled
  resources: { requests: { memory: 32Mi, cpu: 10m }, limits: { memory: 128Mi } }