apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: grafana-stack
  namespace: argocd-system
spec:
  project: default
  source:
    repoURL: https://grafana.github.io/helm-charts
    chart: loki-stack # simplified for demo, or use individual charts for enterprise
    targetRevision: 2.9.11
    # In a real enterprise scenario, we would define Mimir, Tempo, Loki Distributed here individually.
    # For this setup, we will define a master chart or multiple apps. 
    # To keep this file concise, we assume the user's repo has a local chart or we point to 'k8s/values' for overrides.
    # PRO TIP: We will actually use a "Pattern" approach here pointing to the official charts but using our values files.
---
# Mimir (Metrics)
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata: { name: mimir, namespace: argocd-system }
spec:
  project: default
  source:
    repoURL: https://grafana.github.io/helm-charts
    chart: mimir-distributed
    targetRevision: 5.1.0
    helm:
      valueFiles: ["../../values/mimir.yaml"] # Relative path in YOUR git repo
  destination: { namespace: observability-prd, server: https://kubernetes.default.svc }
---
# Tempo (Traces)
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata: { name: tempo, namespace: argocd-system }
spec:
  project: default
  source:
    repoURL: https://grafana.github.io/helm-charts
    chart: tempo-distributed
    targetRevision: 1.7.0
    helm:
      valueFiles: ["../../values/tempo.yaml"]
  destination: { namespace: observability-prd, server: https://kubernetes.default.svc }
---
# Grafana (Visuals + K6 + Faro)
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata: { name: grafana, namespace: argocd-system }
spec:
  project: default
  source:
    repoURL: https://grafana.github.io/helm-charts
    chart: grafana
    targetRevision: 6.61.1
    helm:
      valueFiles: ["../../values/grafana.yaml"]
  destination: { namespace: observability-prd, server: https://kubernetes.default.svc }
---
# OTEL Collectors
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata: { name: otel-collector, namespace: argocd-system }
spec:
  project: default
  source:
    repoURL: https://open-telemetry.github.io/opentelemetry-helm-charts
    chart: opentelemetry-collector
    targetRevision: 0.74.0
    helm:
      valueFiles: ["../../values/otel-collector.yaml"]
  destination: { namespace: observability-prd, server: https://kubernetes.default.svc }