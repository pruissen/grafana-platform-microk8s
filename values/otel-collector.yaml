mode: deployment # Gateway Mode

ports:
  otlp:
    enabled: true
  otlp-http:
    enabled: true
    containerPort: 4318

config:
  receivers:
    otlp:
      protocols:
        grpc:
        http:
          cors:
            allowed_origins: ["*"] # Essential for Faro/Web
  
  processors:
    batch:
    k8sattributes: # Enhance data with K8s info
      auth_type: "serviceAccount"
      passthrough: false
      extract:
        metadata:
          - k8s.pod.name
          - k8s.pod.uid
          - k8s.deployment.name
          - k8s.namespace.name

  exporters:
    prometheusremotewrite: # To Mimir
      endpoint: "http://mimir-distributed-distributor.observability-prd.svc:8080/api/v1/push"
    otlp: # To Tempo (Trace)
      endpoint: "tempo-distributed-distributor.observability-prd.svc:4317"
      tls:
        insecure: true
    loki: # To Loki (Logs)
      endpoint: "http://loki-distributed-distributor.observability-prd.svc:3100/loki/api/v1/push"

  service:
    pipelines:
      metrics:
        receivers: [otlp]
        processors: [batch, k8sattributes]
        exporters: [prometheusremotewrite]
      traces:
        receivers: [otlp]
        processors: [batch, k8sattributes]
        exporters: [otlp]
      logs:
        receivers: [otlp]
        processors: [batch, k8sattributes]
        exporters: [loki]